---
name: setup
description: Install MCP behavior guides to ~/.claude/CLAUDE.md
---

# omc-mcp-extension Setup

Install MCP server behavior guides to your CLAUDE.md for optimal tool selection.

## What This Does

1. Reads MCP behavior guides from the plugin's `mcp/` directory
2. Adds them to `~/.claude/CLAUDE.md` with markers
3. Preserves existing CLAUDE.md content

## Markers Used

```markdown
<!-- OMC-MCP-EXT:START -->
... MCP behavior guides ...
<!-- OMC-MCP-EXT:END -->
```

## Execution Steps

### Step 1: Check Current State

Read `~/.claude/CLAUDE.md` and check if markers already exist.

```bash
CLAUDE_MD="$HOME/.claude/CLAUDE.md"
if grep -q "<!-- OMC-MCP-EXT:START -->" "$CLAUDE_MD" 2>/dev/null; then
  echo "Markers found - will update existing content"
else
  echo "No markers found - will append new content"
fi
```

### Step 2: Prepare MCP Guides Content

Combine all MCP behavior guides into one block:

```markdown
<!-- OMC-MCP-EXT:START -->
# MCP Server Behavior Guides (omc-mcp-extension)

> Auto-generated by /omc-mcp-extension:setup
> These guides help Claude select the appropriate MCP tools.

## Serena MCP Server
[Content from mcp/MCP_Serena.md]

## Sequential-Thinking MCP Server
[Content from mcp/MCP_Sequential.md]

## Morphllm MCP Server
[Content from mcp/MCP_Morphllm.md]

<!-- OMC-MCP-EXT:END -->
```

### Step 3: Update CLAUDE.md

**If markers exist:** Replace content between markers
**If no markers:** Append to end of file

Use this bash script:

```bash
#!/bin/bash
CLAUDE_MD="$HOME/.claude/CLAUDE.md"
PLUGIN_DIR="${CLAUDE_PLUGIN_ROOT:-$(dirname $(dirname $(realpath $0)))}"
START_MARKER="<!-- OMC-MCP-EXT:START -->"
END_MARKER="<!-- OMC-MCP-EXT:END -->"

# Build content from mcp/*.md files
build_content() {
  echo "$START_MARKER"
  echo "# MCP Server Behavior Guides (omc-mcp-extension)"
  echo ""
  echo "> Auto-generated by /omc-mcp-extension:setup"
  echo "> These guides help Claude select the appropriate MCP tools."
  echo ""

  for md_file in "$PLUGIN_DIR/mcp/MCP_"*.md; do
    if [[ -f "$md_file" ]]; then
      echo "---"
      echo ""
      cat "$md_file"
      echo ""
    fi
  done

  echo "$END_MARKER"
}

# Create CLAUDE.md if not exists
if [[ ! -f "$CLAUDE_MD" ]]; then
  mkdir -p "$(dirname "$CLAUDE_MD")"
  echo "# User Instructions" > "$CLAUDE_MD"
  echo "" >> "$CLAUDE_MD"
fi

# Check if markers exist
if grep -q "$START_MARKER" "$CLAUDE_MD"; then
  # Replace existing content between markers
  temp_file=$(mktemp)
  awk -v start="$START_MARKER" -v end="$END_MARKER" -v content="$(build_content)" '
    $0 ~ start { skip=1; print content; next }
    $0 ~ end { skip=0; next }
    !skip { print }
  ' "$CLAUDE_MD" > "$temp_file"
  mv "$temp_file" "$CLAUDE_MD"
  echo "✅ Updated existing MCP guides in CLAUDE.md"
else
  # Append to end
  echo "" >> "$CLAUDE_MD"
  build_content >> "$CLAUDE_MD"
  echo "✅ Added MCP guides to CLAUDE.md"
fi
```

### Step 4: Show Completion Message

```
✅ MCP Behavior Guides Installed!

INSTALLED GUIDES:
- Serena: Semantic code analysis + session memory
- Sequential-Thinking: Structured multi-step reasoning
- Morphllm: Pattern-based bulk code editing

LOCATION: ~/.claude/CLAUDE.md

These guides help Claude automatically select the right MCP tool:
- Symbol operations → Serena
- Complex analysis → Sequential-Thinking
- Bulk edits → Morphllm

TO UPDATE: Run /omc-mcp-extension:setup again
TO REMOVE: Delete content between <!-- OMC-MCP-EXT:START --> and <!-- OMC-MCP-EXT:END --> markers
```

## Uninstall

To remove the MCP guides, delete the content between markers in `~/.claude/CLAUDE.md`:

```bash
sed -i '' '/<!-- OMC-MCP-EXT:START -->/,/<!-- OMC-MCP-EXT:END -->/d' ~/.claude/CLAUDE.md
```
